# ğŸ“§ SPAM & PHISHING Detector - Full Stack ML Application

[![Python](https://img.shields.io/badge/python-3.12-blue.svg)](https://www.python.org/downloads/)
[![Reflex](https://img.shields.io/badge/reflex-0.6+-purple.svg)](https://reflex.dev)
[![FastAPI](https://img.shields.io/badge/fastapi-0.109+-green.svg)](https://fastapi.tiangolo.com)
[![Docker](https://img.shields.io/badge/docker-ready-blue.svg)](https://www.docker.com)
[![Code Style](https://img.shields.io/badge/code%20style-ruff-black)](https://github.com/astral-sh/ruff)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

**Production-ready full-stack email threat detection system** using Machine Learning with Reflex (Python) frontend and FastAPI backend.

## ğŸ—ï¸ Project Structure

```
spam-phishing-detector/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ backend/              # FastAPI + ML (Python 3.12)
â”‚   â”‚   â”œâ”€â”€ spam_detector/    # Python package (hexagonal architecture)
â”‚   â”‚   â”œâ”€â”€ tests/            # Unit + integration tests
â”‚   â”‚   â”œâ”€â”€ Dockerfile        # Production-ready (multi-stage, NO-ROOT)
â”‚   â”‚   â””â”€â”€ .dockerignore
â”‚   â””â”€â”€ frontend/             # Reflex UI (Python fullstack)
â”‚       â”œâ”€â”€ spam_detector_ui/ # Reflex application
â”‚       â”‚   â”œâ”€â”€ components/   # UI components
â”‚       â”‚   â”œâ”€â”€ pages/        # Pages (index)
â”‚       â”‚   â”œâ”€â”€ state/        # State management
â”‚       â”‚   â””â”€â”€ services/     # API client
â”‚       â”œâ”€â”€ Dockerfile        # Production-ready (multi-stage, NO-ROOT)
â”‚       â””â”€â”€ .dockerignore
â”œâ”€â”€ models/                   # ML models (Git LFS tracked, mounted as volume in Docker)
â”œâ”€â”€ docs/                     # Documentation
â”œâ”€â”€ historyMD/                # Development history and guides
â”œâ”€â”€ docker-compose.yml        # Full-stack deployment (backend + frontend)
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md                 # This file
```

## âœ¨ Features

### ğŸ¯ ML Capabilities
- **Dual Detection**: Simultaneous SPAM and PHISHING classification
- **High Accuracy**: ~95% SPAM, ~92% PHISHING detection
- **Fast Inference**: <10ms per email
- **Model Versioning**: MLflow + Git LFS

### ğŸš€ Interfaces
- **Modern Web UI**: Reflex (Python fullstack framework)
- **REST API**: FastAPI with automatic OpenAPI docs
- **CLI Tool**: Rich terminal interface

### ğŸ›ï¸ Architecture
- **Backend**: Hexagonal/Clean Architecture (FastAPI)
- **Frontend**: Reflex (Python, generates Next.js)
- **Type Safety**: End-to-end with Pydantic
- **Testing**: Comprehensive test suites
- **Deployment**: Docker Compose with multi-stage builds

## ğŸš€ Quick Start

### Prerequisites

- **Python 3.12+** (backend + frontend)
- **uv** (recommended): `curl -LsSf https://astral.sh/uv/install.sh | sh`
- **Docker** (recommended, for containerized deployment)

### Option 1: Development Setup

#### Backend

```bash
cd src/backend

# Create virtual environment
uv venv && source .venv/bin/activate

# Install dependencies
uv sync

# Run API server
spam-detector-api
# â†’ http://localhost:8000
# â†’ Docs: http://localhost:8000/docs

# Or use CLI
spam-detector predict "URGENT! You won a lottery!"
```

#### Frontend (Reflex)

```bash
cd src/frontend

# Create virtual environment
python -m venv venv && source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Start dev server
reflex run
# â†’ http://localhost:3000
```

### Option 2: Docker Compose (Recommended)

```bash
# Build and run both services
docker-compose build
docker-compose up -d

# Verify health checks
docker ps

# Access:
# - Frontend: http://localhost:3000
# - Backend API: http://localhost:8000
# - API Docs: http://localhost:8000/docs

# View logs
docker-compose logs -f

# Stop services
docker-compose down
```

**See [historyMD/DOCKER_GUIDE.md](historyMD/DOCKER_GUIDE.md) for complete Docker documentation.**

## ğŸ“š Documentation

| Document | Description |
|----------|-------------|
| [Backend README](src/backend/README.md) | Backend setup, API docs, CLI usage |
| [Frontend README](src/frontend/README.md) | Reflex UI setup and components |
| [Docker Guide](historyMD/DOCKER_GUIDE.md) | Complete Docker deployment guide |
| [Refactor Summary](historyMD/REFACTOR_SUMMARY.md) | Recent architecture changes |
| [Full-Stack Guide](docs/README_FULL_STACK.md) | Complete setup and architecture |

## ğŸ¯ Tech Stack

### Backend
- **Framework**: FastAPI
- **ML**: scikit-learn, NLTK
- **Validation**: Pydantic
- **Testing**: pytest
- **Tooling**: uv, ruff, mypy

### Frontend
- **Framework**: Reflex 0.6+ (Python fullstack)
- **Build**: Next.js (auto-generated by Reflex)
- **State**: Built-in Reflex state management
- **HTTP**: httpx (async client)
- **Styling**: Built-in Chakra UI components

## ğŸ“Š ML Models

| Model | Algorithm | Accuracy | Samples | Features |
|-------|-----------|----------|---------|----------|
| SPAM | Logistic Regression | ~95% | 5,572 | TF-IDF (5000) |
| PHISHING | Logistic Regression | ~92% | 11,430 | TF-IDF (5000) |

Models are versioned with **Git LFS** and tracked with **MLflow**.

## ğŸ”Œ API Usage

### Classify Email

```bash
curl -X POST http://localhost:8000/api/v1/classify \
  -H "Content-Type: application/json" \
  -d '{
    "email_text": "URGENT! You won a lottery! Click here now!"
  }'
```

**Response:**

```json
{
  "verdict": "PHISHING",
  "risk_level": "HIGH",
  "is_malicious": true,
  "spam_probability": 0.505,
  "phishing_probability": 0.985,
  "execution_time_ms": 1.81,
  "threat_report": {
    "risk_score": 84,
    "iocs": [...],
    "recommendations": [...]
  }
}
```

See [API documentation](http://localhost:8000/docs) for complete endpoints.

## ğŸ§ª Testing

### Backend

```bash
cd src/backend
pytest                           # Run all tests
pytest --cov=spam_detector      # With coverage
pytest tests/unit               # Only unit tests
```

### Frontend (Reflex)

```bash
cd src/frontend
reflex init                     # Initialize (first time only)
reflex export                   # Build for production
```

## ğŸš¢ Deployment

### Backend Options
- **Docker**: Use `src/backend/Dockerfile`
- **Railway/Render**: Connect GitHub repo
- **AWS ECS/EKS**: Push to ECR, deploy container

### Full-Stack (Docker Compose)
```bash
# Build and deploy
docker-compose build
docker-compose up -d

# View status
docker ps

# Frontend: http://localhost:3000
# Backend:  http://localhost:8000
```

**Frontend URL**: `http://localhost:3000`  
**Backend URL**: `http://localhost:8000`

See [Docker Guide](historyMD/DOCKER_GUIDE.md) for complete deployment instructions.

## ğŸ¨ Frontend Preview

The Reflex UI features:
- ğŸ **Pure Python** - No JavaScript/TypeScript needed
- ğŸ¨ Built-in Chakra UI components
- ğŸ”„ Real-time state management
- ğŸ“Š Classification results with confidence meters
- ğŸ¯ Color-coded risk levels
- ğŸ“± Responsive design
- âš¡ Fast server-side rendering (SSR) with Next.js

## ğŸ” Security

- âœ… Input validation (Pydantic)
- âœ… CORS configured
- âœ… No secrets in code
- âœ… Type safety (mypy strict)
- âœ… Dependency scanning ready
- âš ï¸ Rate limiting (TODO for production)
- âš ï¸ Authentication (TODO for production)

## ğŸ¤ Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/my-feature`
3. Make changes
4. Run tests: `cd src/backend && pytest`
5. Commit: `git commit -m "feat: add feature"`
6. Push: `git push origin feature/my-feature`
7. Open Pull Request

## ğŸ“ License

MIT License - see [LICENSE](LICENSE) file

## ğŸ† Credits

**Built with:**
- Clean Architecture principles
- Hexagonal/Ports & Adapters pattern
- Modern React best practices
- Type-driven development

**Author**: Adrian Infantes Romero

---

**âš¡ Built for production ML systems**

## ğŸ“¦ Recent Changes (2026-01-11)

- âœ… Migrated frontend from React/Vite to **Reflex** (Python fullstack)
- âœ… Both Docker containers run as **NO-ROOT** for security
- âœ… Enhanced health checks (validate ML models loading)
- âœ… Moved `models/` to project root (better structure)
- âœ… Reduced image sizes by **~70%** (multi-stage builds + .dockerignore)
- âœ… Simplified stack: **100% Python** (no Node.js/TypeScript)

See [REFACTOR_SUMMARY.md](historyMD/REFACTOR_SUMMARY.md) for details.

---

For detailed setup and architecture information:
- **Docker**: [Docker Guide](historyMD/DOCKER_GUIDE.md)
- **Quick Start**: [Quick Start](historyMD/QUICK_START.md)
- **Full-Stack**: [Full-Stack Guide](docs/README_FULL_STACK.md)
