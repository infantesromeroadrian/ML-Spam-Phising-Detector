<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Threat Analyzer - SOC Dashboard</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/dark-theme.css">
    <link rel="stylesheet" href="css/soc-dashboard.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="soc-dark">
    <div class="soc-container">
        <!-- Header -->
        <header class="soc-header">
            <div class="soc-header-title">
                <span class="shield-icon">üõ°Ô∏è</span>
                <span>EMAIL THREAT ANALYZER</span>
            </div>
            <p class="soc-subtitle">Security Operations Center ‚Ä¢ ML-Powered Threat Detection v2.1</p>
        </header>

        <!-- How It Works Section -->
        <section class="bg-card" style="border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); border: 1px solid var(--border-subtle);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--spacing-lg); cursor: pointer;" onclick="toggleSystemInfo()">
                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                    <span style="font-size: 2rem;">üß†</span>
                    <h2 style="color: var(--neon-cyan); font-size: 1.25rem; margin: 0; text-transform: uppercase; letter-spacing: 1px;">
                        HOW THE SYSTEM WORKS
                    </h2>
                </div>
                <span id="toggleIcon" style="color: var(--neon-cyan); font-size: 1.5rem; transition: transform 0.3s;">‚ñº</span>
            </div>
            
            <div id="systemInfoContent" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.7;">
                <p style="margin-bottom: var(--spacing-md);">
                    This system uses <strong style="color: var(--neon-blue);">dual Machine Learning models</strong> to analyze emails and detect threats with high accuracy:
                </p>
                
                <!-- Model Architecture -->
                <div style="background: var(--dark-bg-input); border-left: 3px solid var(--neon-cyan); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border-radius: var(--radius-md);">
                    <h3 style="color: var(--neon-cyan); font-size: 1rem; margin-bottom: var(--spacing-md); text-transform: uppercase; letter-spacing: 1px;">
                        üìä Model Architecture
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-md);">
                        <!-- SPAM Detector -->
                        <div style="background: var(--dark-bg-card); padding: var(--spacing-md); border-radius: var(--radius-md); border: 1px solid var(--border-subtle);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                <span style="font-size: 1.5rem;">üóëÔ∏è</span>
                                <strong style="color: var(--high);">SPAM Detector</strong>
                            </div>
                            <ul style="margin: 0; padding-left: var(--spacing-lg); color: var(--text-muted); font-size: 0.875rem;">
                                <li>Algorithm: <span style="color: var(--text-primary);">Logistic Regression</span></li>
                                <li>Features: <span style="color: var(--text-primary);">TF-IDF Vectorization</span></li>
                                <li>Training: <span style="color: var(--text-primary);">5,000+ emails</span></li>
                                <li>Accuracy: <span style="color: var(--neon-green);">~95%</span></li>
                            </ul>
                        </div>
                        
                        <!-- PHISHING Detector -->
                        <div style="background: var(--dark-bg-card); padding: var(--spacing-md); border-radius: var(--radius-md); border: 1px solid var(--border-subtle);">
                            <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                <span style="font-size: 1.5rem;">üé£</span>
                                <strong style="color: var(--critical);">PHISHING Detector</strong>
                            </div>
                            <ul style="margin: 0; padding-left: var(--spacing-lg); color: var(--text-muted); font-size: 0.875rem;">
                                <li>Algorithm: <span style="color: var(--text-primary);">Logistic Regression</span></li>
                                <li>Features: <span style="color: var(--text-primary);">TF-IDF + URL patterns</span></li>
                                <li>Training: <span style="color: var(--text-primary);">3,500+ emails</span></li>
                                <li>Accuracy: <span style="color: var(--neon-green);">~92%</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Classification Process -->
                <div style="background: var(--dark-bg-input); border-left: 3px solid var(--neon-blue); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border-radius: var(--radius-md);">
                    <h3 style="color: var(--neon-blue); font-size: 1rem; margin-bottom: var(--spacing-md); text-transform: uppercase; letter-spacing: 1px;">
                        ‚öôÔ∏è Classification Process
                    </h3>
                    
                    <ol style="margin: 0; padding-left: var(--spacing-lg); color: var(--text-secondary); font-size: 0.875rem; line-height: 1.8;">
                        <li><strong style="color: var(--text-primary);">Text Preprocessing:</strong> Email content is cleaned and tokenized</li>
                        <li><strong style="color: var(--text-primary);">Feature Extraction:</strong> TF-IDF converts text into numerical features (bag of words)</li>
                        <li><strong style="color: var(--text-primary);">Dual Classification:</strong> Both models analyze the email simultaneously</li>
                        <li><strong style="color: var(--text-primary);">Probability Calculation:</strong> Each model outputs a confidence score (0-100%)</li>
                        <li><strong style="color: var(--text-primary);">Risk Assessment:</strong> Final verdict combines both predictions</li>
                    </ol>
                </div>
                
                <!-- Risk Levels -->
                <div style="background: var(--dark-bg-input); border-left: 3px solid var(--neon-yellow); padding: var(--spacing-lg); border-radius: var(--radius-md);">
                    <h3 style="color: var(--neon-yellow); font-size: 1rem; margin-bottom: var(--spacing-md); text-transform: uppercase; letter-spacing: 1px;">
                        üéØ Risk Levels Explained
                    </h3>
                    
                    <div style="display: grid; gap: var(--spacing-sm); font-size: 0.875rem;">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="color: var(--low);">‚úÖ LOW:</span>
                            <span style="color: var(--text-muted);">Legitimate email (HAM) with high confidence (>80%)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="color: var(--medium);">‚ö†Ô∏è MEDIUM:</span>
                            <span style="color: var(--text-muted);">Uncertain classification or low confidence score</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="color: var(--high);">üî¥ HIGH:</span>
                            <span style="color: var(--text-muted);">Single threat detected (SPAM or PHISHING) with confidence >70%</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span style="color: var(--critical);">üö® CRITICAL:</span>
                            <span style="color: var(--text-muted);">Both SPAM and PHISHING detected simultaneously</span>
                        </div>
                    </div>
                </div>
                
                <!-- Key Features -->
                <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-subtle);">
                    <p style="margin: 0; font-size: 0.875rem; color: var(--text-muted);">
                        <strong style="color: var(--neon-cyan);">üî¨ Technical Details:</strong> 
                        Built with <strong>scikit-learn</strong> (Logistic Regression) ‚Ä¢ 
                        <strong>TF-IDF</strong> vectorization (up to 5000 features) ‚Ä¢ 
                        <strong>Clean Architecture</strong> (Hexagonal pattern) ‚Ä¢ 
                        <strong>FastAPI</strong> backend ‚Ä¢ Real-time classification
                    </p>
                </div>
            </div>
        </section>

        <!-- Input Section -->
        <section id="inputSection">
            <div class="bg-card" style="border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl);">
                <h2 style="color: var(--neon-cyan); font-size: 1.25rem; margin-bottom: var(--spacing-lg); text-transform: uppercase; letter-spacing: 1px;">
                    ‚ö° SCAN EMAIL FOR THREATS
                </h2>
                
                <form id="classifyForm">
                    <!-- Email Content -->
                    <div style="margin-bottom: var(--spacing-lg);">
                        <label for="emailText" style="display: block; margin-bottom: var(--spacing-sm); color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                            Email Content *
                        </label>
                        <textarea 
                            id="emailText" 
                            name="emailText" 
                            rows="8"
                            placeholder="Paste suspicious email content here..."
                            required
                            style="width: 100%; padding: var(--spacing-md); background: var(--dark-bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: var(--font-mono); font-size: 0.875rem; resize: vertical;"
                        ></textarea>
                        <div style="text-align: right; margin-top: var(--spacing-xs); font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono);">
                            <span id="charCount">0</span> characters
                        </div>
                    </div>

                    <!-- Subject -->
                    <div style="margin-bottom: var(--spacing-lg);">
                        <label for="subject" style="display: block; margin-bottom: var(--spacing-sm); color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                            Subject (Optional)
                        </label>
                        <input 
                            type="text" 
                            id="subject" 
                            name="subject" 
                            placeholder="e.g., Urgent Security Alert"
                            style="width: 100%; padding: var(--spacing-md); background: var(--dark-bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: var(--font-mono); font-size: 0.875rem;"
                        >
                    </div>

                    <!-- Sender -->
                    <div style="margin-bottom: var(--spacing-xl);">
                        <label for="sender" style="display: block; margin-bottom: var(--spacing-sm); color: var(--text-secondary); font-size: 0.875rem; text-transform: uppercase; letter-spacing: 1px;">
                            Sender (Optional)
                        </label>
                        <input 
                            type="text" 
                            id="sender" 
                            name="sender" 
                            placeholder="e.g., admin@suspicious-domain.ru"
                            style="width: 100%; padding: var(--spacing-md); background: var(--dark-bg-input); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-family: var(--font-mono); font-size: 0.875rem;"
                        >
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn-soc btn-report" id="submitBtn" style="width: 100%;">
                        <span>üîç INITIATE THREAT SCAN</span>
                    </button>
                </form>
            </div>
        </section>

        <!-- Loading -->
        <div id="loading" style="display: none; text-align: center; padding: var(--spacing-2xl);">
            <div style="display: inline-block; width: 60px; height: 60px; border: 4px solid var(--dark-bg-tertiary); border-top: 4px solid var(--neon-cyan); border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: var(--spacing-lg); color: var(--neon-cyan); font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 2px;">
                SCANNING FOR THREATS...
            </p>
        </div>

        <!-- Results Section -->
        <section id="resultsSection" style="display: none;">
            <!-- Threat Level Banner -->
            <div class="threat-banner" id="threatBanner">
                <div class="threat-banner-header">
                    <div class="threat-level">
                        <span class="threat-level-icon" id="threatIcon">‚ö†Ô∏è</span>
                        <div class="threat-level-text">
                            <h2 id="threatLevel">THREAT LEVEL: <span id="riskLevelText">UNKNOWN</span></h2>
                            <p class="verdict" id="verdictText">ANALYSIS PENDING</p>
                        </div>
                    </div>
                    <div class="threat-confidence">
                        <div class="label">CONFIDENCE</div>
                        <div class="value" id="confidenceValue">--.--%</div>
                    </div>
                </div>
                
                <!-- Risk Score Meter -->
                <div class="risk-meter">
                    <div class="risk-meter-label">
                        <span>RISK SCORE</span>
                        <span id="riskScoreText">0/100</span>
                    </div>
                    <div class="risk-meter-bar">
                        <div class="risk-meter-fill" id="riskMeterFill" style="width: 0%;"></div>
                    </div>
                </div>
            </div>

            <!-- Detection Matrix -->
            <div class="section-header">DETECTION MATRIX</div>
            <div class="detection-matrix">
                <!-- SPAM Card -->
                <div class="detection-card" id="spamCard">
                    <div class="detection-card-header">
                        <span class="detection-card-icon">üóëÔ∏è</span>
                        <h3>SPAM</h3>
                    </div>
                    <div class="detection-percentage" id="spamPercentage">0%</div>
                    <div class="detection-label" id="spamSeverity">UNKNOWN</div>
                    <div class="detection-model" id="spamModel">Model: --</div>
                </div>

                <!-- PHISHING Card -->
                <div class="detection-card" id="phishingCard">
                    <div class="detection-card-header">
                        <span class="detection-card-icon">üé£</span>
                        <h3>PHISHING</h3>
                    </div>
                    <div class="detection-percentage" id="phishingPercentage">0%</div>
                    <div class="detection-label" id="phishingSeverity">UNKNOWN</div>
                    <div class="detection-model" id="phishingModel">Model: --</div>
                </div>

                <!-- MALWARE Card (Placeholder) -->
                <div class="detection-card low">
                    <div class="detection-card-header">
                        <span class="detection-card-icon">ü¶†</span>
                        <h3>MALWARE</h3>
                    </div>
                    <div class="detection-percentage" style="color: var(--low);">N/A</div>
                    <div class="detection-label low">NOT SCANNED</div>
                    <div class="detection-model">Model: v1.0.0 (placeholder)</div>
                </div>
            </div>

            <!-- IOC Section -->
            <div class="section-header">INDICATORS OF COMPROMISE (IOC)</div>
            <div class="ioc-list" id="iocList">
                <p style="text-align: center; color: var(--text-muted); padding: var(--spacing-lg);">
                    No IOCs detected
                </p>
            </div>

            <!-- Trigger Words (ML Explanation) -->
            <div class="section-header">üß† ML FEATURE ANALYSIS</div>
            <div class="bg-card" style="border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: var(--spacing-lg);">
                    Words that triggered the ML classification (feature importance):
                </p>
                
                <!-- SPAM Trigger Words -->
                <div style="margin-bottom: var(--spacing-lg);">
                    <h4 style="color: var(--high); font-size: 0.875rem; margin-bottom: var(--spacing-sm); text-transform: uppercase; letter-spacing: 1px;">
                        üóëÔ∏è SPAM Indicators:
                    </h4>
                    <div id="spamTriggerWords" style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm);">
                        <span style="color: var(--text-muted); font-size: 0.875rem;">No words detected</span>
                    </div>
                </div>
                
                <!-- PHISHING Trigger Words -->
                <div>
                    <h4 style="color: var(--critical); font-size: 0.875rem; margin-bottom: var(--spacing-sm); text-transform: uppercase; letter-spacing: 1px;">
                        üé£ PHISHING Indicators:
                    </h4>
                    <div id="phishingTriggerWords" style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm);">
                        <span style="color: var(--text-muted); font-size: 0.875rem;">No words detected</span>
                    </div>
                </div>
            </div>

            <!-- Threat Vectors -->
            <div class="section-header">THREAT VECTORS</div>
            <div class="threat-vectors-list" id="threatVectorsList">
                <p style="text-align: center; color: var(--text-muted); padding: var(--spacing-lg);">
                    No threat vectors identified
                </p>
            </div>

            <!-- Recommendations -->
            <div class="section-header">RECOMMENDED ACTIONS</div>
            <div class="recommendations-list" id="recommendationsList">
                <p style="text-align: center; color: var(--text-muted); padding: var(--spacing-lg);">
                    No recommendations available
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-soc btn-quarantine" onclick="alert('Quarantine feature (demo)')">
                    üö´ QUARANTINE
                </button>
                <button class="btn-soc btn-report" onclick="alert('Report feature (demo)')">
                    üìä DETAILED REPORT
                </button>
                <button class="btn-soc btn-scan-another" id="scanAnotherBtn">
                    üîÑ SCAN ANOTHER
                </button>
            </div>
        </section>

        <!-- Error Message -->
        <div id="errorMessage" style="display: none; background: var(--dark-bg-card); border: 2px solid var(--critical); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); text-align: center;">
            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">‚ö†Ô∏è</div>
            <h3 style="color: var(--critical); margin-bottom: var(--spacing-md); text-transform: uppercase; letter-spacing: 1px;">
                SYSTEM ERROR
            </h3>
            <p id="errorText" style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);"></p>
            <button class="btn-soc btn-scan-another" id="dismissErrorBtn">DISMISS</button>
        </div>

        <!-- Footer -->
        <footer class="soc-footer">
            <p>‚ö° Analysis completed in <span class="execution-time" id="execTime">0.00</span>ms</p>
            <p style="margin-top: var(--spacing-sm); color: var(--text-muted);">
                Powered by ML ‚Ä¢ FastAPI + Scikit-learn ‚Ä¢ 
                <a href="http://localhost:8000/docs" target="_blank" style="color: var(--neon-blue); text-decoration: none;">API Docs</a>
            </p>
        </footer>
    </div>

    <!-- Keyframes for spinner -->
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- Scripts -->
    <script src="js/soc-app.js"></script>
</body>
</html>
